{% extends 'layout/base.html' %}

{% load static %}

{% block content %}

<!-- Page Wrapper -->
<div id="wrapper">

    {% include 'layout/sidebar.html' %}

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-dark black topbar mb-4 static-top shadow">

                <!-- Sidebar Toggle (Topbar) -->
                <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                    <i style="color: white;" class="fa fa-bars"></i>
                </button>

            </nav>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="d-sm-flex align-items-center justify-content-center mb-4">
                    <h1 class="h3 mb-0 text-gray-800">Materi {{ materi_name }}</h1>
                </div>

                <!-- Content Row -->
                <div class="row d-flex justify-content-center">

                    <!-- Earnings (Monthly) Card Example -->
                    <div class="col-12 col-lg-6">

                        <div class="col">

                            <form method="post">

                                {% csrf_token %}

                                <div class="row">
                                    <div class="col-12 mb-4">
                                        <a href="{{ form_link }}" target="_blank" class="btn btn-block btn-primary">Form
                                            Pengumpulan</a>
                                    </div>

                                    <div class="col-12">
                                        <div class="alert alert-success d-flex justify-content-center" role="alert">
                                            Token: <b>{{ token }}</b>
                                        </div>
                                    </div>
                                </div>

                                <div class="row row-eq-height list-materi-row">
                                    <div class="col-12 col-sm-8">
                                        <div class="form-group">
                                            <input type="text" id="table_search" onkeyup="filterTable();"
                                                placeholder="Search" class="form-control list-materi-btn">
                                        </div>
                                    </div>
                                    <div class="col mb-4">
                                        <a href="{% url 'export_nilaisiswa' mapel_id=mapel_id slug=slug %}"
                                            class="btn btn-success btn-block list-materi-btn" target="_blank">
                                            Export Data
                                        </a>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col d-flex justify-content-end">
                                        <p style="color: rgba(255, 255, 255, 0.9);">Deadline: {{ deadline }}</p>
                                    </div>
                                </div>

                                {% include 'layout/template_messages.html' %}

                                <div class="table-responsive">
                                    <table id="table_siswa" class="w-auto table"
                                        style="background-color: white; text-align: center; min-width: 500px;">
                                        <thead>
                                            <tr>
                                                <th scope="col">No.</th>
                                                <th scope="col">Nama Siswa</th>
                                                <th scope="col" style="width: 20%;">Nilai</th>
                                                <th scope="col">Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            {% if not file_siswa %}
                                            <tr>
                                                <td></td>
                                                <td>Belum ada siswa</td>
                                            </tr>
                                            {% endif %}

                                            {% for siswa in file_siswa %}
                                            <tr>
                                                <td scope="row" class="align-middle">{{ forloop.counter }}</th>
                                                <td class="align-middle">{{ siswa.student_name }}</td>
                                                <td class="align-middle">
                                                    <div class="form-group">
                                                        <input type="number" name="nilai_field" id="id_{{ siswa.id }}"
                                                            class="form-control" value="{{ siswa.nilai }}" min="0"
                                                            max="100" data-bind="value:id_{{ siswa.id }}" step=".1">
                                                        <input type="hidden" name="nilai_id" value="{{ siswa.id }}">
                                                    </div>
                                                </td>
                                                <td class="align-middle">
                                                    <div class="row">
                                                        <div class="col">
                                                            <a
                                                                href="{% url 'download_filesiswa' mapel_id=mapel_id slug=slug filesiswa_id=siswa.id %}"><i
                                                                    style="color: green; font-size: 1.4rem;"
                                                                    class="fas fa-download"></i></a>
                                                        </div>
                                                        <div class="col" id="trash_filesiswa" data-id="{{ siswa.id }}"
                                                            data-name="{{ siswa.student_name }}">
                                                            <a href="#" data-toggle="modal"
                                                                data-target="#hapusfilesiswa_modal"><i
                                                                    style="color: red; font-size: 1.4rem;"
                                                                    class="fas fa-trash"></i></a>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>

                                <div class="d-flex mt-2 mb-4 justify-content-end">
                                    <button class="btn btn-success">Simpan Nilai</button>
                                </div>

                            </form>

                        </div>
                    </div>
                    <!-- /.container-fluid -->

                </div>
                <!-- End of Main Content -->

                <!-- Modal Hapus File Siswa -->
                <div class="modal fade" id="hapusfilesiswa_modal" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header border-bottom-0">
                                <h5 class="modal-title" id="exampleModalLabel" style="font-weight: bold;">Hapus File
                                    Siswa
                                </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>

                            <div class="modal-body" id="hapusFileSiswa_message">
                            </div>
                            <div class="modal-footer border-top-0 d-flex justify-content-center">
                                <div class="col" id="hapusFileSiswa_btn" data-id="0">
                                    <button type="submit" class="btn btn-block btn-success">Hapus</button>
                                </div>
                                <div class="col">
                                    <button type="button" class="btn btn-block btn-danger"
                                        data-dismiss="modal">Batal</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- End of Modal Hapus File Siswa -->

            </div>
            <!-- End of Content Wrapper -->

            {% include 'layout/footer.html' %}

        </div>
        <!-- End of Page Wrapper -->

        {% include 'layout/load_js.html' %}
        <script>
            $('#hapusFileSiswa_btn').click(function () {
                let url = "{% url 'hapus_filesiswa' mapel_id=mapel_id slug=slug filesiswa_id=1 %}".replace(/1/, $(this).data('id'));
                window.location = url;
            });
        </script>

        {% endblock %}